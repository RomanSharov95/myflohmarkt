<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <title>Registrierung | MFM</title>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-6 font-sans">

  <div class="max-w-md w-full bg-white rounded-[2.5rem] shadow-2xl p-8 border border-gray-100 text-center relative overflow-hidden">
    
    <div class="absolute top-0 left-0 right-0 h-2 bg-emerald-600"></div>

    <h1 class="text-3xl font-black text-emerald-600 italic mb-2 mt-4">MyFlohMarkt<span class="text-orange-500 not-italic">.MFM</span></h1>
    <p class="text-gray-400 text-[10px] font-black uppercase tracking-[0.2em] mb-8 text-center">Beta-Test Community</p>

    <form id="regForm" class="space-y-4">
      <input type="text" id="name" placeholder="Vollständiger Name" required 
             class="w-full p-4 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-medium transition-all">
      
      <input type="email" id="email" placeholder="E-Mail Adresse" required 
             class="w-full p-4 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-medium transition-all">
      
      <input type="password" id="password" placeholder="Passwort erstellen" required 
             class="w-full p-4 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-medium transition-all">
      
      <button type="submit" id="submitBtn" disabled
              class="w-full bg-gray-300 text-white py-5 rounded-2xl font-black uppercase tracking-widest text-xs mt-4 transition-all cursor-not-allowed">
        Account erstellen
      </button>
      <p class="mt-6 text-[11px] text-gray-500 font-medium text-center">
        Hast du schon einen Account? 
        <a href="login.html" class="text-emerald-600 font-black underline ml-1 uppercase tracking-wider">Login</a>
      </p>
    </form>

    <div class="mt-4">
        <a href="index.html" class="inline-block w-full py-4 text-gray-400 font-black text-[10px] uppercase tracking-[0.3em] hover:text-orange-500 transition-all active:scale-95">
            Abbrechen
        </a>
    </div>

    <div class="mt-8 pt-6 border-t border-gray-50">
        <p class="text-[10px] text-gray-300 italic leading-relaxed px-4">
          <a href="legal.html" class="text-emerald-500 underline font-bold">Impressum & Datenschutz</a>
        </p>
    </div>
  </div>

<script>
    // Твои данные из Supabase
    const SUPABASE_URL = 'https://kzbwncclswagwshyfdlv.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_eqByuGyYPy0qr1z1yO4X6Q_YwrkV5g5';

    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('regForm');
    const submitBtn = document.getElementById('submitBtn');
    const inputs = form.querySelectorAll('input[required]');

    // Логика кнопки (уже на немецком)
    function checkInputs() {
      let allFilled = true;
      inputs.forEach(input => {
        if (input.value.trim() === '') allFilled = false;
      });
      if (allFilled) {
        submitBtn.disabled = false;
        submitBtn.classList.replace('bg-gray-300', 'bg-emerald-600');
        submitBtn.classList.add('shadow-xl', 'shadow-emerald-100', 'cursor-pointer');
      } else {
        submitBtn.disabled = true;
        submitBtn.classList.replace('bg-emerald-600', 'bg-gray-300');
        submitBtn.classList.remove('shadow-xl', 'shadow-emerald-100', 'cursor-pointer');
      }
    }

    inputs.forEach(input => input.addEventListener('input', checkInputs));

    // Отправка данных в таблицу profiles
    form.onsubmit = async (e) => {
      e.preventDefault();
      
      const name = document.getElementById('name').value;
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      // Сначала регистрируем пользователя в системе Supabase Auth
      const { data: authData, error: authError } = await supabaseClient.auth.signUp({
        email: email,
        password: password,
      });

      if (authError) {
        alert("Fehler: " + authError.message);
      } else {
        // Затем записываем его имя в нашу таблицу profiles
        const { error: dbError } = await supabaseClient
          .from('profiles')
          .insert([{ full_name: name, email: email }]);

        if (dbError) {
          alert("Datenbank-Fehler: " + dbError.message);
        } else {
          alert("Vielen Dank! Dein Account wurde erstellt. Bitte prüfe deine E-Mails zur Bestätigung.");
          window.location.href = "index.html";
        }
      }
    };
</script>
</body>
</html>