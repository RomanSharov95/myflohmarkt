<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <title>Login | MFM</title>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-6 font-sans">

  <div class="max-w-md w-full bg-white rounded-[2.5rem] shadow-2xl p-8 border border-gray-100 text-center relative overflow-hidden">
    
    <div class="absolute top-0 left-0 right-0 h-2 bg-emerald-600"></div>

    <h1 class="text-3xl font-black text-emerald-600 italic mb-2 mt-4">MyFlohMarkt<span class="text-orange-500 not-italic">.MFM</span></h1>
    <p class="text-gray-400 text-[10px] font-black uppercase tracking-[0.2em] mb-8 text-center">Willkommen zurück</p>

    <form id="loginForm" class="space-y-4">
      <input type="email" id="email" placeholder="E-Mail Adresse" required 
             class="w-full p-4 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-medium transition-all">
      
      <input type="password" id="password" placeholder="Passwort" required 
             class="w-full p-4 rounded-2xl bg-gray-50 border-none focus:ring-2 focus:ring-emerald-500 outline-none text-sm font-medium transition-all">
      
      <button type="submit" id="loginBtn" disabled
              class="w-full bg-gray-300 text-white py-5 rounded-2xl font-black uppercase tracking-widest text-xs mt-4 transition-all cursor-not-allowed">
        Einloggen
      </button>
    </form>

    <p class="mt-6 text-[11px] text-gray-500 font-medium">
      Noch kein Konto? 
      <a href="register.html" class="text-emerald-600 font-black underline ml-1 uppercase tracking-wider">Registrieren</a>
    </p>

    <div class="mt-4">
        <a href="index.html" class="inline-block w-full py-2 text-gray-400 font-black text-[10px] uppercase tracking-[0.3em] hover:text-orange-500 transition-all">
            Abbrechen
        </a>
    </div>
  </div>

  <script>
    // Замени на свои реальные ключи из Supabase
    const SUPABASE_URL = 'https://kzbwncclswagwshyfdlv.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_eqByuGyYPy0qr1z1yO4X6Q_YwrkV5g5';
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const form = document.getElementById('loginForm');
    const loginBtn = document.getElementById('loginBtn');
    const inputs = form.querySelectorAll('input[required]');

    // Функция проверки полей для активации кнопки
    function checkInputs() {
      let allFilled = true;
      inputs.forEach(input => {
        if (input.value.trim() === '') allFilled = false;
      });

      if (allFilled) {
        loginBtn.disabled = false;
        loginBtn.classList.replace('bg-gray-300', 'bg-emerald-600');
        loginBtn.classList.add('shadow-xl', 'shadow-emerald-100', 'cursor-pointer', 'active:scale-[0.98]');
      } else {
        loginBtn.disabled = true;
        loginBtn.classList.replace('bg-emerald-600', 'bg-gray-300');
        loginBtn.classList.remove('shadow-xl', 'shadow-emerald-100', 'cursor-pointer', 'active:scale-[0.98]');
      }
    }

    // Слушаем ввод данных
    inputs.forEach(input => {
      input.addEventListener('input', checkInputs);
    });

    // Логика входа
    form.onsubmit = async (e) => {
      e.preventDefault();
      
      // Визуальный фидбек при нажатии
      loginBtn.innerText = "Wird geprüft...";
      loginBtn.classList.add('opacity-70');

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      const { data, error } = await supabaseClient.auth.signInWithPassword({
        email: email,
        password: password,
      });

      if (error) {
        alert("Login fehlgeschlagen: " + error.message);
        loginBtn.innerText = "Einloggen";
        loginBtn.classList.remove('opacity-70');
      } else {
        // Успех! Перенаправляем на главную
        window.location.href = "index.html";
      }
    };
  </script>
</body>
</html>